<!DOCTYPE html>
<html lang="ur">
<head>
<meta charset="UTF-8">
<title>جامعہ اسلامیہ انوار العلوم العلمية - Result System</title>
<style>
body{font-family:Urdu Typesetting,Arial;background:#eef}
h2{text-align:center;color:teal;margin-bottom:10px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border:3px solid teal}
input,button{padding:6px;margin:4px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #333;padding:6px;text-align:center}
.pass{color:green;font-weight:bold}
.fail{color:red;font-weight:bold}
.hidden{display:none}
#cert{border:5px double teal;padding:20px;margin-top:10px;background:#fff}
@media print{
body *{visibility:hidden;}
#cert, #cert *{visibility:visible;}
#cert{position:absolute;left:0;top:0;width:100%;}
}
</style>
</head>
<body>

<h2>جامعہ اسلامیہ انوار العلوم العلمية</h2>
<div class="container">

<!-- STUDENT SEARCH -->
<div id="studentBox">
<input id="rollInput" placeholder="رول نمبر لکھیں">
<button onclick="search()">Search</button>
<div id="output"></div>
<hr>
<button onclick="showAdmin()">Admin Login</button>
</div>

<!-- LOGIN -->
<div id="loginBox" class="hidden">
<h3>Admin Login</h3>
<input id="auser" placeholder="Username">
<input id="apass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<button onclick="back()">Back</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
<h3>Admin Panel</h3>

<input id="rroll" placeholder="Roll">
<input id="rname" placeholder="Name">
<input id="rfather" placeholder="Father">
<input id="rclass" placeholder="Class / Dars">

<h4>Subjects</h4>
<div id="subs"></div>
<button onclick="addSubject()">+ Add Subject</button>

<h4>Settings</h4>
<input type="file" id="logoInput">
<button onclick="saveLogo()">Save Logo</button>
<br><br>
<input id="oldPass" type="password" placeholder="Old Password">
<input id="newPass" type="password" placeholder="New Password">
<button onclick="changePass()">Change Password</button>
<hr>

<button onclick="addResult()">Save Result</button>
<button onclick="clearAll()">Clear All</button>
<button onclick="logout()">Logout</button>

<h4>All Results</h4>
<table id="list"></table>
</div>

</div>

<script>
// --- Admin Credentials ---
let ADMIN_USER="admin";
let ADMIN_PASS=localStorage.getItem("adminPass")||"1234";

// --- Data Storage ---
let data = JSON.parse(localStorage.getItem("results")||"[]");

// --- Functions ---
function save(){localStorage.setItem("results",JSON.stringify(data));}

// Add Subject Input
function addSubject(){
let d=document.createElement("div");
d.innerHTML=`<input placeholder="Subject Name"><input type="number" placeholder="Marks">`;
subs.appendChild(d);
}

// Calculate Grade
function getGrade(marks){
  if(marks>=80) return "ممتاز اعلی";
  else if(marks>=70) return "ممتاز";
  else if(marks>=50) return "جید";
  else if(marks>=40) return "مقبول";
  else return "ناکام";
}

// Search Result
function search(){
let r=rollInput.value;
let f=data.find(x=>x.roll==r);
if(!f){output.innerHTML="❌ رزلٹ نہیں ملا";return;}

// Auto PRC No
let prcNo = f.prc || (Math.floor(1000 + Math.random()*9000));

// Logo
let logo = localStorage.getItem("madrasaLogo") || "";
let logoHTML = logo ? `<img src="${logo}" style="width:80px">` : "";

// Calculate Total, Percentage, Status
let total = f.subjects.reduce((a,b)=>a+b.marks,0);
let max = f.subjects.length*100;
let per = (total/max*100).toFixed(2);
let statusText = per>=40 ? "پاس" : "ناکام";

// Build Certificate HTML
let h = `<div id="cert">
<div style="display:flex;align-items:center;justify-content:space-between">
${logoHTML}
<div style="text-align:center">
<h2>جامعہ اسلامیہ انوار العلوم العلمية</h2>
<h4>نتیجہ سرٹیفکیٹ</h4>
</div>
</div>
<hr>
<b>PRC No:</b> ${prcNo}<br>
<b>نام:</b> ${f.name}<br>
<b>والد:</b> ${f.father}<br>
<b>کلاس:</b> ${f.class}<br>
<table><tr><th>مضمون</th><th>مارکس</th><th>کیفیت</th></tr>`;

f.subjects.forEach(s=>{
  h+=`<tr>
  <td>${s.name}</td>
  <td>${s.marks}</td>
  <td>${getGrade(s.marks)}</td>
  </tr>`;
});

h+=`</table>
<h4>کل مارکس: ${total}/${max}</h4>
<h4>فیصد: ${per}%</h4>
<h4>کیفیت: ${statusText}</h4>
<br>
<button onclick="window.print()">Print Result</button>
</div>`;

output.innerHTML=h;
}

// Show / Hide Admin
function showAdmin(){studentBox.classList.add("hidden");loginBox.classList.remove("hidden");}
function back(){loginBox.classList.add("hidden");studentBox.classList.remove("hidden");}
function login(){
if(auser.value==ADMIN_USER && apass.value==ADMIN_PASS){
loginBox.classList.add("hidden");
adminPanel.classList.remove("hidden");
render();
}else alert("غلط لاگ ان");
}
function logout(){adminPanel.classList.add("hidden");studentBox.classList.remove("hidden");}

// Add / Update Result
function addResult(){
let subsArr=[];
[...subs.children].forEach(d=>{
let n=d.children[0].value;
let m=+d.children[1].value;
if(n && m>=0) subsArr.push({name:n,marks:m});
});
if(!rroll.value){alert("Roll number required");return;}
let obj={
  roll:rroll.value,
  name:rname.value,
  father:rfather.value,
  class:rclass.value,
  subjects:subsArr,
  prc: Math.floor(1000 + Math.random()*9000)
};
let i=data.findIndex(x=>x.roll==obj.roll);
if(i>=0) data[i]=obj; else data.push(obj);
save(); render(); alert("Saved!");
subs.innerHTML="";
}

// Render Result List
function render(){
let t="<tr><th>Roll</th><th>Name</th><th>Delete</th></tr>";
data.forEach((x,i)=>{
t+=`<tr><td>${x.roll}</td><td>${x.name}</td>
<td><button onclick="del(${i})">X</button></td></tr>`;
});
list.innerHTML=t;
}

// Delete Result
function del(i){data.splice(i,1);save();render();}

// Clear All Results
function clearAll(){if(confirm("Delete all?")){data=[];save();render();}}

// Logo Save
function saveLogo(){
let file=logoInput.files[0];
let reader=new FileReader();
reader.onload=function(){localStorage.setItem("madrasaLogo",reader.result);alert("Logo Saved");}
reader.readAsDataURL(file);
}

// Change Admin Password
function changePass(){
if(oldPass.value!==ADMIN_PASS){alert("Old password wrong");return;}
ADMIN_PASS=newPass.value;
localStorage.setItem("adminPass",ADMIN_PASS);
alert("Password Changed");
oldPass.value=""; newPass.value="";
}
</script>
</body>
</html>
